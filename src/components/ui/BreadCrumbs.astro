---
/**
 * Breadcrumb - Navegación de migas de pan accesible
 * Soporta múltiples niveles y Schema.org BreadcrumbList
 */

interface BreadcrumbItem {
    /** Texto a mostrar */
    label: string;
    /** URL del enlace (opcional para el último elemento) */
    href?: string;
}

interface Props {
    /** Lista de items del breadcrumb */
    items: BreadcrumbItem[];
    /** Clase CSS adicional */
    class?: string;
}

const { items, class: className = "" } = Astro.props;

// Generar schema JSON-LD para SEO
const schemaItems = items.map((item, index) => ({
    "@type": "ListItem",
    position: index + 1,
    name: item.label,
    ...(item.href && { item: new URL(item.href, Astro.url.origin).toString() }),
}));
---

<nav aria-label="Breadcrumb" class={`text-sm ${className}`}>
    <ol
        class="flex flex-wrap items-center gap-1.5 text-neutral-600"
        itemscope
        itemtype="https://schema.org/BreadcrumbList"
    >
        {
            items.map((item, index) => {
                const isLast = index === items.length - 1;

                return (
                    <li
                        class="flex items-center gap-1.5"
                        itemprop="itemListElement"
                        itemscope
                        itemtype="https://schema.org/ListItem"
                    >
                        {index > 0 && (
                            <svg
                                class="w-4 h-4 text-neutral-400 shrink-0"
                                aria-hidden="true"
                            >
                                <use href="/icons.svg#chevron-right" />
                            </svg>
                        )}

                        {isLast ? (
                            <span
                                class="text-neutral-900 font-medium truncate max-w-50"
                                itemprop="name"
                                aria-current="page"
                            >
                                {item.label}
                            </span>
                        ) : (
                            <a
                                href={item.href}
                                class="hover:text-primary-600 transition-colors"
                                itemprop="item"
                            >
                                <span itemprop="name">{item.label}</span>
                            </a>
                        )}

                        <meta itemprop="position" content={String(index + 1)} />
                    </li>
                );
            })
        }
    </ol>
</nav>

<!-- Schema.org BreadcrumbList -->
<script
    type="application/ld+json"
    set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        itemListElement: schemaItems,
    })}
/>
