---
import { NAV_OPTIONS, isActive as checkActive, getClientTabs } from "@utils/navigation";

import SignsButtons from "../ui/SignsButtons.astro";
import NavMobile from "./NavMobile.astro";
import BannerHeader from "./BannerHeader.astro";
import Icon from "../ui/Icon.astro";
const { pathname } = Astro.url;

const tabs = getClientTabs(pathname);

const tabBase = "flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-full transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-primary-600";
const tabActive = "bg-white text-primary-700 shadow-sm";
const tabInactive = "text-primary-100 hover:text-white hover:bg-primary-400/50";

// Estilos en constantes para evitar clases duplicadas y mejorar legibilidad
const baseLinkStyles = "text-btn font-medium transition-all duration-300 hover:text-neutral-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-primary-600 rounded";
const activeLinkStyles = "text-white font-bold relative after:content-[''] after:absolute after:-bottom-1 after:left-0 after:w-full after:h-0.5 after:bg-secondary-200";

// Usar función centralizada
const isActive = (href: string) => checkActive(href, pathname);
---

<header
  class="bg-primary-500 px-[5%] sticky top-0 z-50"
>
  <div
    class="max-w-350 mx-auto flex justify-between items-center py-4"
  >
    <div
      class="flex gap-6 items-center"
    >
      <a href="/">
        <img
          src="/logo.png"
          alt="Logotipo de la empresa de El Gordito"
          loading="eager"
          width={200}
          fetchpriority="high"
          class="w-25 lg:w-40"
        />
      </a>

      <div 
        class="hidden lg:flex items-center gap-1 bg-white/20 p-1 rounded-full h-fit"
        role="group"
        aria-label="Tipo de cliente"
      >
        {tabs.map((tab) => (
          <a 
            href={tab.href}
            class:list={[tabBase, tab.active ? tabActive : tabInactive]}
            aria-current={tab.active ? 'page' : undefined}
            title={tab.description}
          >
            <Icon name={tab.icon} class="size-4" aria-hidden="true" />
            <span>{tab.name}</span>
          </a>
        ))}
      </div>
    </div>
    

    <nav aria-label="Navegación principal" class="hidden xl:inline-block">
      <ul class="nav-list flex gap-8 items-center">
        {NAV_OPTIONS.map((option) => {
          const active = isActive(option.href);

          return (
            <li class="relative group">
              <!-- Link principal -->
              <a
                href={option.href}
                class={`${baseLinkStyles} ${
                  active ? activeLinkStyles : "text-primary-100"
                } flex items-center gap-1`}
                aria-current={active ? "page" : undefined}
                aria-haspopup={option.children ? "true" : undefined}
              >
                {option.name}
                {option.children && (
                  <svg
                    class="w-4 h-4 transition-transform group-hover:rotate-180"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    viewBox="0 0 24 24"
                  >
                    <path d="m6 9 6 6 6-6" />
                  </svg>
                )}
              </a>

              <!-- Dropdown -->
              {option.children && (
                <div
                  class="
                    absolute left-0 top-full mt-3
                    w-72
                    rounded-2xl
                    bg-white
                    shadow-xl
                    border border-neutral-200
                    opacity-0 invisible
                    group-hover:opacity-100 group-hover:visible
                    group-focus-within:opacity-100 group-focus-within:visible
                    transition-all duration-200
                    z-50
                  "
                  role="menu"
                >
                  <ul class="py-3">
                    {option.children.map((child) => {
                      const childActive = isActive(child.href);

                      return (
                        <li>
                          <a
                            href={child.href}
                            class={`
                              block px-5 py-3
                              text-sm
                              ${
                                childActive
                                  ? "bg-primary-50 text-primary-600 font-semibold"
                                  : "text-neutral-700 hover:bg-secondary-100"
                              }
                            `}
                            role="menuitem"
                            aria-current={childActive ? "page" : undefined}
                          >
                            <span class="block text-primary-600 font-semibold">{child.name}</span>
                            {child.description && (
                              <span class="block text-xs text-neutral-500">
                                {child.description}
                              </span>
                            )}
                          </a>
                        </li>
                      );
                    })}
                  </ul>
                </div>
              )}
            </li>
          );
        })}
      </ul>
    </nav>

    <SignsButtons/>

    <NavMobile options={NAV_OPTIONS} pathname={pathname}/>
  </div>
</header>