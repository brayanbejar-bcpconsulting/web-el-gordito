---
import { Image } from "astro:assets";
import imgUserDefault from "@assets/shared/user-default.webp";
import SectionHeading from "./ui/SectionHeading.astro";
import ContainerSection from "./ui/ContainerSection.astro";
import Carousel from "./ui/Carousel.astro";
import Icon from "./ui/Icon.astro";
import { parseSimpleMarkdown } from "@/utils/markdown";

const testimoniosCards = [
  {
    imagen: imgUserDefault,
    name: "Victor Ruiz M.",
    opinion: "Increíble. Tuve que **pagar mi tarjeta de crédito a las 9 PM** y TKambio fue la única que me atendió en minutos. Me salvaron de los intereses.",
    ubicacion: "Ica, Perú",
  },
  {
    imagen: imgUserDefault,
    name: "Ricardo Morales L.",
    opinion: "Tenía dudas por ser mi primera vez cambiando online, pero su asesor por WhatsApp me guio paso a paso. Todo transparente y seguro.",
    ubicacion: "Arequipa, Perú",
  },
  {
    imagen: imgUserDefault,
    name: "Jesús Hernández U.",
    opinion: "Como freelancer recibo pagos en dólares. Con ellos recibo mucho más soles que en mi banco habitual. La diferencia se nota a fin de mes.",
    ubicacion: "Lima, Perú",
  },
  {
    imagen: imgUserDefault,
    name: "María Medina G.",
    opinion: "Excelente servicio. El proceso es intuitivo y la atención al cliente es personalizada. Definitivamente mi opción favorita.",
    ubicacion: "Piura, Perú",
  },
];
---

<ContainerSection ariaLabelledby="titulo-testimonios" class="bg-neutral-cool-50/50">
  <SectionHeading
    id="titulo-testimonios"
    title="Voces que avalan nuestra"
    subtitle="trayectoria"
    align="center"
    shortText="Testimonios"
    description="Más de 50,000 peruanos ya optimizan sus finanzas con nuestra plataforma."
    class="mb-14"
  />

  <Carousel data={testimoniosCards} visibleDesktop={3}>
    {
      testimoniosCards.map((testimonio) => {
        const imgFinal = testimonio.imagen || imgUserDefault;

        return (
          <article class="h-full py-8 group">
            <div class="relative flex flex-col h-full bg-white rounded-3xl p-7 lg:p-9 shadow-sm border border-neutral-cool-100 transition-all duration-500 group-hover:shadow-xl group-hover:shadow-primary-900/5 group-hover:-translate-y-1">
              
              <div class="flex justify-between items-start mb-6">
                <div class="flex gap-1 text-secondary-500">
                  {[...Array(5)].map(() => (
                    <Icon name="star" class="size-4 fill-current" />
                  ))}
                </div>
                <div class="text-primary-100 opacity-50 group-hover:text-primary-200 transition-colors">
                  <svg class="size-10" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.154c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z" />
                  </svg>
                </div>
              </div>

              <blockquote class="grow">
                <p class="text-neutral-cool-700 leading-relaxed text-[0.95rem] lg:text-base italic" set:html={parseSimpleMarkdown(testimonio.opinion)} />
              </blockquote>

              <footer class="mt-8 flex items-center gap-4 pt-6 border-t border-neutral-cool-50">
                <div class="relative">
                  <div class="absolute inset-0 bg-primary-200 rounded-full blur-sm opacity-0 group-hover:opacity-40 transition-opacity"></div>
                  <Image
                    src={imgFinal}
                    alt={testimonio.name}
                    width={52}
                    height={52}
                    class="relative rounded-full border-2 border-white shadow-sm object-cover"
                  />
                </div>
                <div>
                  <h3 class="text-base font-bold text-primary-950 leading-tight">
                    {testimonio.name}
                  </h3>
                  <div class="flex items-center gap-1.5 mt-0.5">
                    <Icon name="map-pin" class="size-3 text-primary-500" />
                    <span class="text-xs font-semibold text-neutral-cool-500 uppercase tracking-wider">
                      {testimonio.ubicacion}
                    </span>
                  </div>
                </div>
              </footer>

            </div>
          </article>
        );
      })
    }
  </Carousel>
</ContainerSection>